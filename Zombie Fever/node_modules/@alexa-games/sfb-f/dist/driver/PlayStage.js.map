{"version":3,"file":"PlayStage.js","sourceRoot":"","sources":["../../driver/PlayStage.ts"],"names":[],"mappings":"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","sourcesContent":["import { SceneAudioItem, VisualOptions, AudioItem } from '../driver/driverEntity';\nimport { AudioItemUtil } from './AudioItemUtil';\n\nexport class PlayStage {\n    private visitedSceneIDsOnRun: string[] = [];\n\n    private speechAudioSequence: SceneAudioItem[] = [];\n\n    private repromptAudioSequence: SceneAudioItem[] = [];\n\n    private recapAudioSequence: SceneAudioItem[] = [];\n\n    private visualOptions: VisualOptions[] | undefined = undefined;\n\n    private currentSceneID: string = \"\";\n\n    private currentSceneAudioQueue: SceneAudioItem = {\n        foreground: [],\n        background: []\n    };\n\n    private currentSceneRepromptAudioQueue: SceneAudioItem = {\n        foreground: [],\n        background: []\n    };\n\n    private currentSceneRecapAudioQueue: SceneAudioItem = {\n        foreground: [],\n        background: []\n    };\n\n    constructor(private audioItemUtil: AudioItemUtil) {\n        this.resetStage();\n    }\n\n    public resetStage(): void {\n        this.currentSceneID = \"\";\n\n        this.visitedSceneIDsOnRun = [];\n\n        this.speechAudioSequence = [];\n    \n        this.repromptAudioSequence = [];\n    \n        this.recapAudioSequence = [];\n    \n        this.visualOptions = undefined;\n    \n        this.currentSceneAudioQueue = {\n            foreground: [],\n            background: []\n        };\n    \n        this.currentSceneRepromptAudioQueue = {\n            foreground: [],\n            background: []\n        };\n    \n        this.currentSceneRecapAudioQueue = {\n            foreground: [],\n            background: []\n        };\n    }\n\n    public logVisitedScene(sceneID: string): void {\n        this.visitedSceneIDsOnRun.push(sceneID);\n    }\n\n    public getVisitedSceneIDsOnRun(): string[] {\n        return this.visitedSceneIDsOnRun;\n    }\n\n    public getStageSpeechAudioSequence(keepScenesSeperate?: boolean): SceneAudioItem[] {\n        return this.audioItemUtil.condensePollyItem(this.speechAudioSequence, keepScenesSeperate);\n    }\n\n    public getStageRepromptAudioSequence(): SceneAudioItem[] {\n        return this.audioItemUtil.condensePollyItem(this.repromptAudioSequence);\n    }\n\n    public getStageRecapAudioSequence(): SceneAudioItem[] {\n        return this.audioItemUtil.condensePollyItem(this.recapAudioSequence);\n    }\n    \n    public getStageVisualOptions(): VisualOptions[] | undefined {\n        return this.visualOptions;\n    }\n\n    public setStageSpeechAudioSequence(audio: SceneAudioItem[]): void {\n        this.speechAudioSequence = audio;\n    }\n\n    public setStageRepromptAudioSequence(audio: SceneAudioItem[]): void {\n        this.repromptAudioSequence = audio;\n    }\n\n    public setStageRecapAudioSequence(audio: SceneAudioItem[]): void {\n        this.recapAudioSequence = audio;\n    }\n    \n    public setStageVisualOptions(visuals: VisualOptions[]): void {\n        this.visualOptions = visuals;\n    }\n\n    public appendStageSpeechAudioSequence(audio: SceneAudioItem[]): void {\n        this.speechAudioSequence = this.speechAudioSequence.concat(audio);\n    }\n\n    public appendStageRepromptAudioSequence(audio: SceneAudioItem[]): void {\n        this.repromptAudioSequence = this.repromptAudioSequence.concat(audio);\n    }\n\n    public appendStageRecapAudioSequence(audio: SceneAudioItem[]): void {\n        this.recapAudioSequence = this.recapAudioSequence.concat(audio);\n    }\n\n    public appendStageVisuals(visuals: VisualOptions): void {\n        if (!this.visualOptions) {\n            this.visualOptions = [];\n        }\n        \n        // Set the sceneID for these visuals to the current scene\n        visuals.sceneID = this.currentSceneID;\n\n        this.visualOptions.push(visuals);\n    }\n\n    public startNewScene(sceneID : string): void {\n        this.currentSceneID = sceneID;\n\n        this.currentSceneAudioQueue = {\n            sceneID,\n            foreground: [],\n            background: []\n        };\n    \n        this.currentSceneRepromptAudioQueue = {\n            sceneID,\n            foreground: [],\n            background: []\n        };\n    \n        this.currentSceneRecapAudioQueue = {\n            sceneID,\n            foreground: [],\n            background: []\n        };\n    }\n\n    public appendSceneSpeechForeground(audioItem: AudioItem[]): void {\n        this.currentSceneAudioQueue.foreground = this.currentSceneAudioQueue.foreground.concat(audioItem);\n    }\n\n    public appendSceneSpeechBackground(audioItem: AudioItem[]): void {\n        this.currentSceneAudioQueue.background = this.currentSceneAudioQueue.foreground.concat(audioItem);\n    }\n\n    public appendSceneRepromptForeground(audioItem: AudioItem[]): void {\n        this.currentSceneRepromptAudioQueue.foreground = this.currentSceneRepromptAudioQueue.foreground.concat(audioItem);\n    }\n\n    public appendSceneRepromptBackground(audioItem: AudioItem[]): void {\n        this.currentSceneRepromptAudioQueue.background = this.currentSceneRepromptAudioQueue.background.concat(audioItem);\n    }\n\n    public appendSceneRecapForeground(audioItem: AudioItem[]): void {\n        this.currentSceneRecapAudioQueue.foreground = this.currentSceneRecapAudioQueue.foreground.concat(audioItem);\n    }\n\n    public appendSceneRecapBackground(audioItem: AudioItem[]): void {\n        this.currentSceneRecapAudioQueue.background = this.currentSceneRecapAudioQueue.background.concat(audioItem);\n    }\n\n    public getSpeechSceneAudio(): SceneAudioItem {\n        return this.currentSceneAudioQueue;\n    }\n\n    public getRepromptSceneAudio(): SceneAudioItem {\n        return this.currentSceneRepromptAudioQueue;\n    }\n\n    public getRecapSceneAudio(): SceneAudioItem {\n        return this.currentSceneRecapAudioQueue;\n    }\n\n    public closeScene(): void {\n        if (this.currentSceneAudioQueue.foreground.length > 0 || this.currentSceneAudioQueue.background.length > 0) {\n            this.speechAudioSequence = this.speechAudioSequence.concat(this.currentSceneAudioQueue);\n        }\n\n        if (this.currentSceneRepromptAudioQueue.foreground.length > 0 || this.currentSceneRepromptAudioQueue.background.length > 0) {\n            this.repromptAudioSequence = this.repromptAudioSequence.concat(this.currentSceneRepromptAudioQueue);\n        }\n\n        if (this.currentSceneRecapAudioQueue.foreground.length > 0 || this.currentSceneRecapAudioQueue.background.length > 0) {\n            this.recapAudioSequence = this.recapAudioSequence.concat(this.currentSceneRecapAudioQueue);\n        }\n    }\n}"]}