{"version":3,"file":"advancedAPLExtension.spec.js","sourceRoot":"","sources":["../../../src/test/aceExtension/advancedAPLExtension.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from 'path';\nimport { strict as assert } from 'assert';\n\nimport { ConfigAccessor } from '../../configAccessor';\nimport { AdvancedAPLExtension } from '../../aceExtension/advancedAPLExtension';\n\nconst CONFIG_FILE = \"./src/test/data/abcConfig.json\";\n\ndescribe('Advanced Alexa APL Extension Test', () => {\n\n    it('Initialization', async () => {\n\n        const config = await ConfigAccessor.loadConfigFile(path.resolve(CONFIG_FILE), \"./src/test/data\");\n\n        const alexaAPLExtension = new AdvancedAPLExtension('en-us', config);\n\n        assert.ok(alexaAPLExtension);\n    });\n\n    it('Generate Alexa Speak Items', async () => {\n\n        const config = await ConfigAccessor.loadConfigFile(path.resolve(CONFIG_FILE), \"./src/test/data\");\n\n        const alexaAPLExtension = new AdvancedAPLExtension('en-us', config);\n\n        assert.ok(alexaAPLExtension);\n\n        const result = alexaAPLExtension.generateAlexaSpeakItemComponents([\"test string\", \"another string\"]);\n\n        assert.ok(result);\n        assert.ok(result.textComponents.length === 2);\n        assert.ok(result.textDatasources.length === 2);\n    });\n\n    it('Test Add Layout and Commands to Dynamic Pager Directive', async () => {\n\n        const config = await ConfigAccessor.loadConfigFile(path.resolve(CONFIG_FILE), \"./src/test/data\");\n\n        const alexaAPLExtension = new AdvancedAPLExtension('en-us', config);\n\n        assert.ok(alexaAPLExtension);\n\n        const visualDirective = TEST_VISUAL_DIRECTIVE;\n\n        const scenes = [\n            {\n                \"template\": \"dynamic-pager\",\n                \"layout\": \"DiceRollAutoLayout\",\n                \"D\": \"20\",\n                \"roll\": \"9\",\n                \"sceneID\": \"display_dice_roll_auto\"\n            }\n        ];\n\n        alexaAPLExtension.addLayoutsAndCommandsToDynamicPagerDirective(visualDirective, scenes);\n\n        console.log(JSON.stringify(visualDirective, undefined, 4));\n\n        assert.ok(visualDirective);\n\n    });\n\n\n\n});\n\nconst TEST_VISUAL_DIRECTIVE = {\n    \"type\": \"Alexa.Presentation.APL.RenderDocument\",\n    \"token\": \"ABC_RENDERED_DOCUMENT\",\n    \"document\": {\n        \"type\": \"APL\",\n        \"version\": \"1.1\",\n        \"commands\": {},\n        \"layouts\": {\n            \"DynamicPager\": {\n                \"description\": \"A dynamic screen pager that takes layouts of any specified 'layout' type. Automatically pulls in all layouts/commands from any other APL template that defines at least one layout specified in an ABC for the given request.\",\n                \"parameters\": [\n                    \"data\"\n                ],\n                \"item\": [\n                    {\n                        \"type\": \"Pager\",\n                        \"id\": \"primaryPager\",\n                        \"navigation\": \"none\",\n                        \"initialPage\": 0,\n                        \"width\": \"100%\",\n                        \"height\": \"100%\",\n                        \"data\": \"${data}\",\n                        \"items\": [\n                            {\n                                \"position\": \"absolute\",\n                                \"type\": \"${data.layout}\",\n                                \"pgIndex\": \"${index}\"\n                            }\n                        ]\n                    }\n                ]\n            }\n        },\n        \"mainTemplate\": {\n            \"description\": \"********* Minimal APL document **********\",\n            \"parameters\": [\n                \"payload\"\n            ],\n            \"items\": [\n                {\n                    \"type\": \"Container\",\n                    \"width\": \"100%\",\n                    \"height\": \"100%\",\n                    \"items\": [\n                        {\n                            \"id\": \"SFBAudioAndAlexaSpeechContainer\",\n                            \"description\": \"Please do not remove or change the ID of this component. Skill Flow Builder uses this id to play audio files and to add Alexa SpeakItem text blocks.\",\n                            \"type\": \"Container\",\n                            \"items\": [\n                                {\n                                    \"type\": \"Video\",\n                                    \"id\": \"audioPlayerId\",\n                                    \"description\": \"Please do not change this ID, skill flow builder uses this component to play audio files from your content.\",\n                                    \"autoplay\": false,\n                                    \"width\": \"0\",\n                                    \"height\": \"0\"\n                                }\n                            ]\n                        },\n                        {\n                            \"id\": \"sampleBackground\",\n                            \"type\": \"Image\",\n                            \"source\": \"${payload.visualProperties.background}\",\n                            \"position\": \"absolute\",\n                            \"width\": \"100vw\",\n                            \"height\": \"100vh\",\n                            \"scale\": \"best-fill\"\n                        },\n                        {\n                            \"id\": \"logo\",\n                            \"type\": \"Image\",\n                            \"source\": \"\",\n                            \"position\": \"absolute\",\n                            \"left\": \"2vw\",\n                            \"top\": \"2vh\",\n                            \"width\": \"20vw\",\n                            \"height\": \"10vh\",\n                            \"scale\": \"best-fit\"\n                        },\n                        {\n                            \"position\": \"absolute\",\n                            \"type\": \"DynamicPager\",\n                            \"data\": \"${payload.visualProperties.scenes}\"\n                        },\n                        {\n                            \"position\": \"absolute\",\n                            \"textAlign\": \"center\",\n                            \"top\": \"10vh\",\n                            \"left\": \"0vw\",\n                            \"height\": \"20vh\",\n                            \"width\": \"100vw\",\n                            \"type\": \"Text\",\n                            \"color\": \"#FFFFFF\",\n                            \"text\": \"${payload.visualProperties.title}\"\n                        },\n                        {\n                            \"position\": \"absolute\",\n                            \"textAlign\": \"center\",\n                            \"type\": \"Text\",\n                            \"color\": \"#FFFFFF\",\n                            \"width\": \"100vw\",\n                            \"bottom\": \"0vh\",\n                            \"text\": \"${payload.visualProperties.subtitle}\"\n                        }\n                    ]\n                }\n            ]\n        }\n    },\n    \"datasources\": {\n        \"visualProperties\": {\n            \"title\": \"\",\n            \"subtitle\": \"\",\n            \"background\": \"\",\n            \"scenes\": [],\n            \"template\": \"dynamic-pager\",\n            \"layout\": \"DiceRollAutoLayout\",\n            \"D\": \"20\",\n            \"roll\": \"9\",\n            \"sceneID\": \"display_dice_roll_auto\"\n        }\n    }\n};\n"]}