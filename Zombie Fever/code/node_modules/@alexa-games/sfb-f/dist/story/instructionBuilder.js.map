{"version":3,"file":"instructionBuilder.js","sourceRoot":"","sources":["../../story/instructionBuilder.ts"],"names":[],"mappings":"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","sourcesContent":["import { AudioBlendOption, VisualOptions} from '../driver/driverEntity';\nimport {Instruction, InstructionType} from '../story/storyMetadata';\n\nexport class InstructionBuilder {\n    instructions: Instruction[] = [];\n\n    private nestingStack: Instruction[] = [];\n\n    constructor() {\n    }\n\n\n    public registerChoiceDirections(utterances: string[], directions: Instruction[], narration?: string, saveToHistory: boolean = true) {\n        let parameters: any = {\n            utterances: utterances,\n            saveToHistory: String(saveToHistory),\n            directions: directions\n        }\n\n        if (narration) {\n            parameters.narration = narration;\n        }\n\n        this.instructions.push({\n            directionType: InstructionType.CHOICE,\n            parameters: parameters\n        });\n\n        return this;\n    }\n\n    public startChoice(utterances: string[], narration?: string, saveToHistory: boolean = true) {\n        let parameters: any = {\n            utterances: utterances,\n            saveToHistory: String(saveToHistory)\n        }\n\n        if (narration) {\n            parameters.narration = narration;\n        }\n\n        let direction: Instruction = {\n            directionType: InstructionType.CHOICE,\n            parameters: parameters\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);   \n        }\n\n        this.nestingStack.push(direction);\n\n        return this;\n    }\n\n    public registerCondition(conditionString: string, directions: Instruction[]) {\n        let parameters: any = {\n            condition: conditionString,\n            directions: directions\n        }\n\n        this.instructions.push({\n            directionType: InstructionType.CONDITION,\n            parameters: parameters\n        });\n\n        return this;\n    }\n\n    public startCondition(conditionString: string) {\n        let parameters: any = {\n            condition: conditionString,\n        }\n\n        let direction: Instruction = {\n            directionType: InstructionType.CONDITION,\n            parameters: parameters\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);   \n        }\n\n        this.nestingStack.push(direction);\n\n        return this;\n    }\n\n    public goTo(targetSceneID: string, targetSceneProperty?: string) {\n        let parameters: any = {\n            target: targetSceneID,\n        }\n\n        if (targetSceneProperty) {\n            parameters.targetSceneProperty = targetSceneProperty;\n        }\n\n        let direction: Instruction = {\n            directionType: InstructionType.GO_TO,\n            parameters: parameters\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);\n        }\n\n        return this;\n    }\n\n    public saveAndGoTo(targetSceneID: string, targetSceneProperty?: string) {\n        let parameters: any = {\n            target: targetSceneID,\n        }\n\n        if (targetSceneProperty) {\n            parameters.targetSceneProperty = targetSceneProperty;\n        }\n\n        let direction: Instruction = {\n            directionType: InstructionType.SAVE_AND_GO,\n            parameters: parameters\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);\n        }\n\n        return this;\n    }\n\n    public return() {\n        let direction: Instruction = {\n            directionType: InstructionType.RETURN,\n            parameters: {}\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);\n        }\n\n        return this;\n    }\n\n    public pause() {\n        let direction: Instruction = {\n            directionType: InstructionType.PAUSE,\n            parameters: {}\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);\n        }\n\n        return this;\n    }\n\n    public restart() {\n        let direction: Instruction = {\n            directionType: InstructionType.RESTART,\n            parameters: {}\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);\n        }\n\n        return this;\n    }\n\n    public repeat() {\n        let direction: Instruction = {\n            directionType: InstructionType.REPEAT,\n            parameters: {}\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);\n        }\n\n        return this;\n    }\n\n    public repeatReprompt() {\n        let direction: Instruction = {\n            directionType: InstructionType.REPEAT_REPROMPT,\n            parameters: {}\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);\n        }\n\n        return this;\n    }\n\n    public goBack(backNumber: number) {\n        let direction: Instruction = {\n            directionType: InstructionType.BACK,\n            parameters: {\n                count: backNumber\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);\n        }\n\n        return this;\n    }\n\n    public setReprompt(repromptSSML: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.REPROMPT,\n            parameters: {\n                message: repromptSSML,\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);\n        }\n\n        return this;\n    }\n\n    public setBackgroundMusic(audioURL: string, delayMs?: string, volume?: string, blendOption?: AudioBlendOption) {\n        let param: any = {\n            audioURL: audioURL\n        }\n\n        if (delayMs) param.delayMs = delayMs;\n        if (volume) param.volume = volume;\n        if (blendOption) param.blend = blendOption;\n\n        let direction: Instruction = {\n            directionType: InstructionType.BGM,\n            parameters: param\n        };\n        \n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n        }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n    }\n\n    public setVisuals(visualOptions : VisualOptions) {\n\n        let params : {[key: string]: string;}= {};\n        Object.keys(visualOptions).forEach(function(key) {\n            params[ key ] = visualOptions[key];\n        }); \n\n        this.instructions.push({\n            directionType: InstructionType.VISUALS,\n            parameters: params\n        });\n        \n        return this;\n    }\n\n    public increaseVariable(variableName: string, increaseBy: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.INCREASE,\n            parameters: {\n                variableName: variableName,\n                variableValue: increaseBy\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public multiplyVariable(variableName: string, multiplyBy: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.MULTIPLY,\n            parameters: {\n                variableName: variableName,\n                variableValue: multiplyBy\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public divideVariable(variableName: string, divideBy: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.DIVIDE,\n            parameters: {\n                variableName: variableName,\n                variableValue: divideBy\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public modVariable(variableName: string, modBy: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.MODULUS,\n            parameters: {\n                variableName: variableName,\n                variableValue: modBy\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public reduceVariable(variableName: string, reduceBy: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.REDUCE,\n            parameters: {\n                variableName: variableName,\n                variableValue: reduceBy\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public setVariable(variableName: string, value: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.SET,\n            parameters: {\n                variableName: variableName,\n                variableValue: value\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n        \n        return this;\n    }\n\n    public setSlot(variableName: string, slotType: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.SLOT,\n            parameters: {\n                variableName: variableName,\n                variableType: slotType\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n        \n        return this;\n    }\n\n    public flag(variableName: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.FLAG,\n            parameters: {\n                variableName: variableName\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public unflag(variableName: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.UNFLAG,\n            parameters: {\n                variableName: variableName\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public clearVariable(variableName: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.CLEAR,\n            parameters: {\n                variableName: variableName\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public setRecap(message: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.RECAP,\n            parameters: {\n                message: message,\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public addToInventory(variableName: string, item: string) {\n        let param: any = {\n            variableName: variableName,\n            itemName: item,\n        }\n\n        let direction: Instruction = {\n            directionType: InstructionType.ADD_TO_INVENTORY,\n            parameters: param\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public addItem(variableName: string, item: string, listSizeLimit?: number) {\n        let param: any = {\n            variableName: variableName,\n            itemName: item,\n        }\n\n        if (listSizeLimit) {\n            param.size = String(listSizeLimit);\n        }\n\n        let direction: Instruction = {\n            directionType: InstructionType.ADD_ITEM,\n            parameters: param\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n        \n        return this;\n    }\n\n    public removeItem(variableName: string, item: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.REMOVE_ITEM,\n            parameters: {\n                variableName: variableName,\n                itemName: item\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public removeFirstItem(listName: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.REMOVE_FIRST,\n            parameters: {\n                variableName: listName\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n        \n        return this;\n    }\n    \n    public removeLastItem(listName: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.REMOVE_LAST,\n            parameters: {\n                variableName: listName\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public rollDice(diceString: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.ROLL,\n            parameters: {\n                diceString: diceString\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public markEnding() {\n        let direction: Instruction = {\n            directionType: InstructionType.END,\n            parameters: {}\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n        return this;\n    }\n\n    public closeChoice() {\n        if (this.nestingStack.length > 0) {\n            this.nestingStack.splice(this.nestingStack.length - 1, 1);\n        }\n\n        return this;\n    }\n\n    public closeCondition() {\n        if (this.nestingStack.length > 0) {\n            this.nestingStack.splice(this.nestingStack.length - 1, 1);\n        }\n\n        return this;\n    }\n\n    /**\n     * @deprecated Use addInstruction() instead\n     */\n    public addSceneDirection(direction: Instruction) {\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n        this.instructions.push(JSON.parse(JSON.stringify(direction)));\n        }\n        return this;\n    }\n\n    public addInstruction(direction: Instruction) {\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n        this.instructions.push(JSON.parse(JSON.stringify(direction)));\n        }\n        return this;\n    }\n\n    public customDirection(customDirectionName: string, customParameters: {[key:string]: string} = {}) {\n        let direction: Instruction = {\n            directionType: InstructionType.CUSTOM,\n            parameters: Object.assign({\n                customName: customDirectionName\n            }, customParameters)\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public getCurrentEpochTime() {\n        let direction: Instruction = {\n            directionType: InstructionType.GET_TIME,\n            parameters: {}\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n    \n    public setBookmark(bookmarkName: string, sceneName?: string) {\n        let direction: Instruction = {\n            directionType: InstructionType.BOOKMARK,\n            parameters: {\n                variableName: bookmarkName,\n                variableValue: sceneName\n            }\n        };\n\n        if (this.nestingStack.length > 0) {\n            if (!this.nestingStack[this.nestingStack.length - 1].parameters.directions) {\n                this.nestingStack[this.nestingStack.length - 1].parameters.directions = [];\n            }\n\n            this.nestingStack[this.nestingStack.length - 1].parameters.directions.push(direction);\n        } else {\n            this.instructions.push(direction);    \n        }\n\n        return this;\n    }\n\n    public build() {\n        return this.instructions;\n    }\n}"]}